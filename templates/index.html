<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="https://unpkg.com/@blaze/css@x.x.x/dist/blaze/blaze.css">
</head>
<body>
<div>
    <input id="url" type="text" class="c-field" name="url"/><br/>
    <button id="submit" type="submit" class="c-button" value="Submit">OK</button>
    <br />
    <h1 id="notice"></h1>
</div>

<script>
    var socket = new WebSocket("wss://heistia.herokuapp.com/download-txt");
window.addEventListener('load', (event) => {
    let url = document.getElementById('url');
    let submit = document.getElementById('submit');
    let notice = document.getElementById('notice')

    submit.onclick = submitClicked;

    socket.onmessage = function({data}) {
        let textFile = null;
        try{
            if(JSON.parse(data)){
                let {status} = JSON.parse(data);
                notice.innerText = `May ${status} na!`
            }

            else {
                let story = eval(data).join("\n");
                var data = new Blob([story], {type: 'text/plain'});
                if (textFile !== null) {
                    window.URL.revokeObjectURL(textFile);
                }
                textFile = window.URL.createObjectURL(data);
                let a = document.createElement('a');
                a.href=textFile;
                a.download="file.txt";
                a.click()
                notice.innerText = "tapos na. :)"
            }
        }
        catch(e){
            let story = eval(data).join("\n");
            var data = new Blob([story], {type: 'text/plain'});
            if (textFile !== null) {
                window.URL.revokeObjectURL(textFile);
            }
            textFile = window.URL.createObjectURL(data);
            let a = document.createElement('a');
            a.href=textFile;
            a.download="file.txt";
            a.click()
            notice.innerText = "tapos na. :)"
        }
    };

    function submitClicked(){
        notice.style = "color: green;"
        notice.innerText = "Paki wait unti lang..."
        let link = url.value;
        socket.send(link);
    }



})
</script>

</body>
</html>